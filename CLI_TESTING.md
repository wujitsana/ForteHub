# ForteHub CLI Test Harness

This repo now includes `scripts/run_full_flow.sh`, a Flow CLI harness that walks through the complete ForteHub lifecycle:

1. Initialize managers for creator/seller/buyer accounts
2. Deploy + register a workflow contract
3. Clone the workflow into a seller wallet
4. (Optionally) enable scheduling
5. List the resulting `WorkflowToken` on ForteHubMarket
6. Purchase the listing from a second wallet
7. Lock further clones from the creator wallet

## Prerequisites

- Flow CLI installed and pointed at the emulator or testnet
- `flow.json` with the signers you plan to use (defaults: `fortehub-v3`, `fortehub-v2`, `fortehub`)
- The workflow contract you want to deploy uploaded to IPFS (set `WORKFLOW_IPFS` + `sourceCodeHash` inside your deploy transaction)

## Usage

```bash
export FLOW_CMD="flow --network testnet"
export CREATOR_SIGNER=fortehub-v3
export SELLER_SIGNER=fortehub-v2
export SELLER_ADDRESS=0xd695aea7bfa88279
export BUYER_SIGNER=fortehub
export WORKFLOW_IMPORT_NAME=TestWorkflow
export WORKFLOW_CONTRACT_ADDRESS=0xd695aea7bfa88279
export WORKFLOW_DEPLOY_TX="cadence/transactions/fortehub/TestWorkflowDeploy.cdc"
export WORKFLOW_DEPLOY_ARGS="--arg Address:0xd695aea7bfa88279"
export WORKFLOW_ID=1
export LISTING_PRICE=10.0
./scripts/run_full_flow.sh
```

The script prints each step before running it. If you already have listings in ForteHubMarket state, bump `LISTING_ID` accordingly. Review the Flow CLI output after each step to confirm success (transaction IDs, emitted events, etc.).

### Custom workflow deployment

If you deploy a different workflow contract:

1. Update `WORKFLOW_IMPORT_NAME` and `WORKFLOW_CONTRACT_ADDRESS`
2. Point `WORKFLOW_DEPLOY_TX` / `WORKFLOW_DEPLOY_ARGS` at the deployment transaction that registers it (e.g., a per-contract deploy transaction generated by the frontend)
3. Ensure the deployment transaction references the correct IPFS CID + `sourceCodeHash`

After the harness runs, you can inspect the results using existing scripts:

- `flow scripts execute cadence/scripts/GetWorkflow.cdc --arg UInt64:$WORKFLOW_ID`
- `flow scripts execute cadence/scripts/GetMarketplaceListing.cdc --arg Address:$SELLER_ADDRESS --arg UInt64:$LISTING_ID`
